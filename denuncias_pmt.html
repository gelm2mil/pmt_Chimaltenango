<!DOCTYPE html>
<html lang="es">
<head>
  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#00eaff">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Denuncias 2026 — PMT Chimaltenango</title>

  <link rel="stylesheet" href="styles.css">

  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at 0 0,#28d7ff 0,#150027 45%,#050109 100%);
      color:#e8f9ff;
    }
    .app-shell{min-height:100vh;display:flex;justify-content:center;padding:20px;}
    .panel{width:100%;max-width:1300px;background:#14091f;border-radius:28px;
      box-shadow:0 0 40px rgba(255,0,255,0.35);border:2px solid rgba(255,0,255,0.25);padding:22px;}
    .section-box{margin-top:16px;background:#120116;border-radius:22px;padding:18px;}
    .form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px 20px;}
    input,textarea{
      background:#120116;border-radius:999px;border:1px solid #ff7bff66;
      padding:8px 12px;color:#ffeaff;
    }
    textarea{border-radius:16px;resize:vertical;}
    .btn{border:none;border-radius:999px;padding:10px 20px;font-weight:600;cursor:pointer;}
    .btn-primary{background:linear-gradient(135deg,#ff5cff,#8b2bff);color:white;}
    table{width:100%;border-collapse:collapse;margin-top:12px;}
    th,td{padding:8px 10px;border-bottom:1px solid #ffffff22;}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<div class="app-shell">
  <div class="panel">

    <h1>DENUNCIAS 2026 — PMT CHIMALTENANGO</h1>

    <!-- NUEVA DENUNCIA -->
    <section class="section-box">
      <h2>Nueva denuncia</h2>

      <div class="form-grid">
        <input id="fecha" type="date">
        <input id="hora" type="time">

        <input id="identificador" placeholder="Placa / DPI / Nombre">
        <input id="tipoDenuncia" placeholder="Tipo de denuncia (vía pública, agresión, abuso, corrupción...)">

        <input id="lugar" placeholder="Lugar del hecho">
        <input id="estado" placeholder="Estado (pendiente, urgente, grave...)">

        <textarea id="descripcion" placeholder="Descripción de la denuncia"></textarea>
        <textarea id="observaciones" placeholder="Observaciones adicionales"></textarea>

        <input id="imagen" type="file" accept="image/*">
      </div>

      <button class="btn btn-primary" id="btn-agregar">Agregar denuncia</button>
    </section>

    <!-- TABLA -->
    <section class="section-box">
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>ID</th>
            <th>Tipo</th>
            <th>Lugar</th>
            <th>Estado</th>
            <th>Descripción</th>
          </tr>
        </thead>
        <tbody id="tabla-denuncias"></tbody>
      </table>
    </section>

  </div>
</div>

<script>
console.log("✔ Denuncias 2026 cargado");

/* ================== CONFIG ================== */
const STORAGE_KEY_DEN = "denuncias2026";
const GOOGLE_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbxEaxAeBVeS4Pk8VO-2HNaM4AA5YdhwTYK8KK5QQK4taFV35JCa8Cs-JHwwQbuRRMYHVw/exec";

/* ================== ELEMENTOS ================== */
const fecha = document.getElementById("fecha");
const hora = document.getElementById("hora");
const identificador = document.getElementById("identificador");
const tipoDenuncia = document.getElementById("tipoDenuncia");
const lugar = document.getElementById("lugar");
const estado = document.getElementById("estado");
const descripcion = document.getElementById("descripcion");
const observaciones = document.getElementById("observaciones");
const tablaBody = document.getElementById("tabla-denuncias");

let denuncias = JSON.parse(localStorage.getItem(STORAGE_KEY_DEN) || "[]");

/* ================== GOOGLE ================== */
function enviarAGoogle(d) {
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      ...d,
      sistema: "DENUNCIAS 2026 PMT CHIMALTENANGO",
      timestamp: new Date().toISOString()
    })
  }).catch(err => console.warn("Google error", err));
}

/* ================== RENDER ================== */
function render() {
  tablaBody.innerHTML = "";
  denuncias.forEach(d => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.fecha}</td>
      <td>${d.hora || ""}</td>
      <td>${d.id}</td>
      <td>${d.tipoDenuncia}</td>
      <td>${d.lugar}</td>
      <td>${d.estado}</td>
      <td>${d.descripcion}</td>
    `;
    tablaBody.appendChild(tr);
  });
}

/* ================== EVENTO ================== */
document.getElementById("btn-agregar").addEventListener("click", () => {

  if (!fecha.value || !descripcion.value) {
    alert("Fecha y descripción son obligatorias");
    return;
  }

  const denuncia = {
    id: "DEN-" + Date.now(),
    fecha: fecha.value,
    hora: hora.value,
    identificador: identificador.value,
    tipoDenuncia: tipoDenuncia.value,
    lugar: lugar.value,
    estado: estado.value,
    descripcion: descripcion.value,
    observaciones: observaciones.value
  };

  denuncias.push(denuncia);
  localStorage.setItem(STORAGE_KEY_DEN, JSON.stringify(denuncias));

  enviarAGoogle(denuncia);
  render();

  // limpiar
  document.querySelectorAll("input, textarea").forEach(e => e.value = "");
});

render();
</script>
</body>
</html>
