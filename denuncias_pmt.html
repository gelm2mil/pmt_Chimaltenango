<div class="modulo fade-in">

    <h2 style="color:#00ff99;text-shadow:0 0 12px #00ff99;">
        DENUNCIAS — PMT CHIMALTENANGO
    </h2>
    <p class="muted">Registro profesional de denuncias con evidencia</p>

    <!-- ================= FORMULARIO ================ -->
    <div style="margin-top:25px; background:rgba(0,0,0,0.55); padding:25px; border-radius:15px;
                border:2px solid #00ff99; box-shadow:0 0 18px #00ff99;">

        <!-- FORMULARIO CORREO -->
        <form action="https://formsubmit.co/nerox2mil@proton.me"
              method="POST"
              enctype="multipart/form-data"
              style="margin-bottom:25px;">

            <input type="hidden" name="_subject" value="Nueva denuncia ciudadana - PMT Chimaltenango">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="false">
            <input type="hidden" name="_next" value="https://gelm2mil.github.io/pmt_Chimaltenango/">

            <h3 style="color:#00ff99;">Nueva denuncia (ciudadana)</h3>

            <label>Fecha</label>
            <input type="text" name="Fecha" placeholder="dd/mm/aaaa" required>

            <label>Hora</label>
            <input type="text" name="Hora" placeholder="--:--" required>

            <label>Placa / DPI / Motor</label>
            <input type="text" name="Placa_DPI_Motor" required>

            <label>Tipo de denuncia</label>
            <select name="Tipo_denuncia">
                <option>Transporte ilegal</option>
                <option>Mal servicio</option>
                <option>Exceso de pasajeros</option>
                <option>Irrespeto PMT</option>
                <option>Otros</option>
            </select>

            <label>Estado</label>
            <select name="Estado">
                <option>Pendiente</option>
                <option>En investigación</option>
                <option>Finalizado</option>
            </select>

            <label>Lugar</label>
            <input type="text" name="Lugar">

            <label>Descripción del hecho</label>
            <textarea name="Descripcion_hecho"></textarea>

            <label>Imagen / evidencia (opcional)</label>
            <input type="file" name="Imagen" accept="image/*">

            <button class="btn-neon" type="submit"
                    style="margin-top:15px; background:#ff00ff; border:none;
                           padding:12px 18px; border-radius:10px; cursor:pointer;">
                ENVIAR DENUNCIA
            </button>
        </form>

        <!-- FORMULARIO PMT (BASE DE DATOS) -->
        <form id="formPMT" onsubmit="enviarPMT(); return false;"
              enctype="multipart/form-data">

            <h3 style="color:#00ff99; margin-top:35px;">Registro interno PMT</h3>

            <label>Fecha</label>
            <input type="text" id="p_fecha" placeholder="dd/mm/aaaa" required>

            <label>Hora</label>
            <input type="text" id="p_hora" placeholder="--:--" required>

            <label>Placa / DPI / Motor</label>
            <input type="text" id="p_placa" required>

            <label>Tipo</label>
            <input type="text" id="p_tipo" placeholder="Ej: Ilegal, Mal servicio..." required>

            <label>Estado</label>
            <input type="text" id="p_estado" placeholder="Pendiente, Investigando..." required>

            <label>Lugar</label>
            <input type="text" id="p_lugar">

            <label>Descripción</label>
            <textarea id="p_descripcion"></textarea>

            <label>Notas internas (PMT)</label>
            <textarea id="p_interno"></textarea>

            <label>Foto (opcional)</label>
            <input type="file" id="p_foto" accept="image/*">

            <button type="submit"
                    style="margin-top:15px; background:#00ffaa; border:none;
                           padding:12px 18px; border-radius:10px; cursor:pointer;">
                AGREGAR DENUNCIA (PMT)
            </button>
        </form>

        <p id="respuestaPMT" style="margin-top:15px; color:#00ff99; font-weight:bold;"></p>

    </div>
</div>

<!-- =============== SCRIPT PARA GUARDAR EN MIARROBA ================ -->
<script>
function enviarPMT() {

    let datos = new FormData();
    datos.append("fecha", document.getElementById("p_fecha").value);
    datos.append("hora", document.getElementById("p_hora").value);
    datos.append("placa", document.getElementById("p_placa").value);
    datos.append("tipo", document.getElementById("p_tipo").value);
    datos.append("estado", document.getElementById("p_estado").value);
    datos.append("lugar", document.getElementById("p_lugar").value);
    datos.append("descripcion", document.getElementById("p_descripcion").value);
    datos.append("interno", document.getElementById("p_interno").value);

    let archivo = document.getElementById("p_foto").files[0];
    if (archivo) { datos.append("foto", archivo); }

    fetch("https://gelmhistoria.webcindario.com/guardar.php", {
        method: "POST",
        body: datos
    })
    .then(r => r.json())
    .then(respuesta => {
        let msj = document.getElementById("respuestaPMT");
        if (respuesta.status === "ok") {
            msj.innerHTML = "✔ Denuncia registrada correctamente.";
            msj.style.color = "#00ff99";
        } else {
            msj.innerHTML = "❌ Error al guardar: " + respuesta.msg;
            msj.style.color = "red";
        }
    })
    .catch(error => {
        document.getElementById("respuestaPMT").innerHTML =
            "❌ Error de conexión con el servidor.";
    });
}
</script>
